# IssueSuite Architecture Overview

IssueSuite is a Python CLI that declaratively manages GitHub issues from a single Markdown source of truth. This document summarizes the core components and how they interact.

## High-level flow

1. **CLI (`src/issuesuite/cli.py`)** parses arguments, loads configuration, and dispatches subcommands.
2. **Runtime helpers (`src/issuesuite/runtime.py`)** wrap command execution with telemetry emission and plugin invocation.
3. **Core engine (`src/issuesuite/core.py`)** parses specs, computes a sync plan, and orchestrates create/update/close operations against GitHub or mock clients.
4. **Orchestrator (`src/issuesuite/orchestrator.py`)** persists mapping state, enriches summaries, and enforces body diff truncation.
5. **GitHub integration (`src/issuesuite/github_issues.py`, `src/issuesuite/github_auth.py`)** centralizes REST requests and retries (`src/issuesuite/retry.py`).
6. **Project integration (`src/issuesuite/project.py`)** optionally syncs issues into Projects (v2) using cached metadata stored in `.issuesuite_cache/`.

```text
ISSUES.md  -> parser -> plan builder -> GitHub client
   |            |             |               |
   |            v             v               v
   +--> SuiteConfig ----> orchestrator ----> telemetry/plugins
```

## Key packages

| Module | Responsibility |
| --- | --- |
| `parser.py` | Validates the spec format and converts Markdown sections into structured issue definitions |
| `core.py` | Compares desired state against live issues and computes mutations |
| `orchestrator.py` | Applies the plan, updates mapping files, and returns enriched summaries |
| `runtime.py` | Provides `prepare_config` and `execute_command` helpers so the CLI stays thin |
| `telemetry.py` | Emits lightweight JSONL events when enabled |
| `plugins.py` | Discovers entry points or environment-provided hooks and invokes them safely |
| `schemas.py` | Generates JSON schemas for exported data |
| `scaffold.py` | Implements the `issuesuite init` scaffolder |

## Configuration lifecycle

- Configuration is parsed via `load_config` in `config.py`. Environment variables can fill sensitive fields using the `$VAR` syntax.
- Runtime overrides (e.g., `--repo`, `--project-number`) are applied before the command executes.
- Telemetry and plugin settings are read once per command and passed into runtime helpers.

## Testing strategy

- Unit tests under `tests/` rely on mock mode (`ISSUES_SUITE_MOCK=1`) for deterministic behavior.
- CLI smoke tests (`tests/test_cli_basic.py`) exercise parsing, syncing, and schema generation end-to-end.
- Specialized suites cover parser edge cases, mapping persistence, project integration, and retry logic.

## Extensibility points

- **Plugins**: Loaded through entry points or `ISSUESUITE_PLUGINS`, receiving command payloads generated by `_plugin_payload` attributes from handlers (e.g., sync summaries or upgrade suggestions).
- **Telemetry**: Adds observability without affecting command success or failureâ€”exceptions never bubble out of emitters.
- **Scaffolding**: Templates under `src/issuesuite/templates/` make it easy to extend generated assets.

For deeper dives into specific subsystems see:

- [Index mapping design](index-mapping-design.md)
- [Extensions, plugins, and telemetry](extensions.md)
- [Configuration reference](../reference/configuration.md)
